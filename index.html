<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>Bible Engine — Demo (full)</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;padding:18px;background:#fafafa}
  .box{background:#fff;padding:12px;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,.06);margin-bottom:12px}
  label{display:inline-block;width:100px}
  input,select,button{padding:6px;margin:4px}
  pre{background:#222;color:#e8e8e8;padding:10px;border-radius:6px;white-space:pre-wrap}
</style>
</head>
<body>
  <h1>Bible Engine — Demo</h1>

  <div class="box">
    <h3>1. Книги</h3>
    <button id="btnBooks">Показать книги</button>
    <div id="booksOut"></div>
  </div>

  <div class="box">
    <h3>2. Главы (по книге)</h3>
    <label>Книга №</label><input id="chapBook" type="number" value="1" min="1">
    <button id="btnChapters">Показать главы</button>
    <pre id="chaptersOut"></pre>
  </div>

  <div class="box">
    <h3>3. Стихи главы</h3>
    <label>Книга</label><input id="versBook" type="number" value="1" min="1">
    <label>Глава</label><input id="versChapter" type="number" value="1" min="1">
    <button id="btnVerses">Показать стихи</button>
    <pre id="versesOut"></pre>
  </div>

  <div class="box">
    <h3>4. Конкретный стих</h3>
    <label>Книга</label><input id="vBook" type="number" value="1">
    <label>Глава</label><input id="vChapter" type="number" value="1">
    <label>Стих</label><input id="vVerse" type="number" value="1">
    <button id="btnVerse">Показать</button>
    <pre id="verseOut"></pre>
  </div>

  <div class="box">
    <h3>5. Диапазон (например: 1,3,5-7)</h3>
    <label>Книга</label><input id="rBook" type="number" value="1">
    <label>Глава</label><input id="rChapter" type="number" value="1">
    <label>Диапазон</label><input id="rRange" value="1-3">
    <button id="btnRange">Показать диапазон</button>
    <pre id="rangeOut"></pre>
  </div>

  <div class="box">
    <h3>6. Поиск (строка)</h3>
    <input id="q" placeholder="Например: Бог">
    <button id="btnSearch">Поиск</button>
    <pre id="searchOut"></pre>
  </div>

  <div class="box">
    <h3>7. Поиск (RegExp)</h3>
    <input id="qRegex" placeholder="Например: (?<!\p{L})Бог(?!\p{L})">
    <button id="btnSearchRegex">Поиск Regex</button>
    <pre id="searchRegexOut"></pre>
  </div>

  <div class="box">
    <h3>8. Случайный стих</h3>
    <button id="btnRandom">Показать случайный</button>
    <pre id="randomOut"></pre>
  </div>

<script src="https://christian-word.github.io/bible-engine/bible-API.js"></script>
<script>
  // Убедимся, что bible готов
  const out = id => document.getElementById(id);

  async function ensureReady() {
    if (!window.bible) throw new Error('Bible API not found');
    try {
      await window.bible.ready();
      // loaded
    } catch (e) {
      alert('Ошибка загрузки Bible JSON. Смотри консоль.');
      throw e;
    }
  }

  document.getElementById('btnBooks').addEventListener('click', async () => {
    await ensureReady();
    const books = await bible.getBooks();
    out('booksOut').innerHTML = books.map(b => `${b.number}. ${b.name}`).join('<br>');
  });

  document.getElementById('btnChapters').addEventListener('click', async () => {
    await ensureReady();
    const book = document.getElementById('chapBook').value;
    const ch = await bible.getChapters(book);
    out('chaptersOut').textContent = JSON.stringify(ch, null, 2);
  });

  document.getElementById('btnVerses').addEventListener('click', async () => {
    await ensureReady();
    const b = document.getElementById('versBook').value;
    const c = document.getElementById('versChapter').value;
    const verses = await bible.getVerses(b, c);
    out('versesOut').textContent = JSON.stringify(verses, null, 2);
  });

  document.getElementById('btnVerse').addEventListener('click', async () => {
    await ensureReady();
    const b = document.getElementById('vBook').value;
    const c = document.getElementById('vChapter').value;
    const v = document.getElementById('vVerse').value;
    const verse = await bible.getVerse(b, c, v);
    out('verseOut').textContent = verse ? `${verse.number}. ${verse.text}` : 'Не найдено';
  });

  document.getElementById('btnRange').addEventListener('click', async () => {
    await ensureReady();
    const b = document.getElementById('rBook').value;
    const c = document.getElementById('rChapter').value;
    const r = document.getElementById('rRange').value;
    const arr = await bible.getVersesRange(b, c, r);
    out('rangeOut').textContent = JSON.stringify(arr, null, 2);
  });

  document.getElementById('btnSearch').addEventListener('click', async () => {
    await ensureReady();
    const q = document.getElementById('q').value;
    const res = await bible.search(q);
    out('searchOut').textContent = JSON.stringify(res.slice(0,200), null, 2);
  });

  document.getElementById('btnSearchRegex').addEventListener('click', async () => {
    await ensureReady();
    const q = document.getElementById('qRegex').value;
    const res = await bible.searchRegex(q);
    out('searchRegexOut').textContent = JSON.stringify(res.slice(0,200), null, 2);
  });

  document.getElementById('btnRandom').addEventListener('click', async () => {
    await ensureReady();
    const r = await bible.getRandomVerse();
    out('randomOut').textContent = r ? `${r.book} ${r.chapter}:${r.verse} — ${r.text}` : 'No data';
  });

  // auto show books when loaded
  (async () => {
    try {
      await ensureReady();
      const bs = await bible.getBooks();
      out('booksOut').innerHTML = bs.map(b=>`${b.number}. ${b.name}`).join('<br>');
    } catch(e){}
  })();
</script>
</body>
</html>
